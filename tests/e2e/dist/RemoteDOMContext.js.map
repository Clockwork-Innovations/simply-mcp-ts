{
  "version": 3,
  "sources": ["../../../src/client/remote-dom/RemoteDOMContext.tsx"],
  "sourcesContent": ["/**\n * Remote DOM Context\n *\n * React Context system for Remote DOM component composition.\n * Provides access to the Worker Manager and utilities for component implementation.\n *\n * This module enables React components to:\n * 1. Access the Remote DOM Worker Manager\n * 2. Generate unique node IDs\n * 3. Send operations to the worker\n * 4. Register event handlers\n *\n * @module client/remote-dom/RemoteDOMContext\n */\n\nimport React, { createContext, useContext, useState, useCallback } from 'react';\nimport { RemoteDOMWorkerManager } from './RemoteDOMWorkerManager.js';\nimport type { RemoteDOMOperation } from './types.js';\n\n/**\n * Remote DOM Context Value\n *\n * Value provided by the RemoteDOMContext.\n */\nexport interface RemoteDOMContextValue {\n  /**\n   * Worker Manager instance\n   */\n  manager: RemoteDOMWorkerManager;\n\n  /**\n   * Send an operation to the worker\n   */\n  sendOperation: (operation: RemoteDOMOperation) => Promise<any>;\n\n  /**\n   * Register an event handler\n   */\n  registerEventHandler: (nodeId: string, eventType: string, handler: Function) => string;\n\n  /**\n   * Unregister an event handler\n   */\n  unregisterEventHandler: (handlerId: string) => void;\n\n  /**\n   * Event handler registry\n   */\n  eventHandlers: Map<string, Function>;\n}\n\n/**\n * Remote DOM Context\n *\n * Context for sharing Remote DOM Manager across component tree.\n */\nconst RemoteDOMContext = createContext<RemoteDOMContextValue | null>(null);\n\n/**\n * Remote DOM Provider Props\n */\nexport interface RemoteDOMProviderProps {\n  /**\n   * Worker Manager instance\n   */\n  manager: RemoteDOMWorkerManager;\n\n  /**\n   * Child components\n   */\n  children: React.ReactNode;\n}\n\n/**\n * Remote DOM Provider\n *\n * Wraps component tree to provide Remote DOM functionality.\n *\n * @example\n * ```tsx\n * const manager = new RemoteDOMWorkerManager();\n * await manager.init();\n *\n * <RemoteDOMProvider manager={manager}>\n *   <Button onClick={() => console.log('clicked')}>\n *     Click Me\n *   </Button>\n * </RemoteDOMProvider>\n * ```\n */\nexport const RemoteDOMProvider: React.FC<RemoteDOMProviderProps> = ({ manager, children }) => {\n  // Event handler registry (handlerId -> handler function)\n  const [eventHandlers] = useState(() => new Map<string, Function>());\n\n  /**\n   * Send operation to worker\n   */\n  const sendOperation = useCallback(\n    async (operation: RemoteDOMOperation) => {\n      return manager.sendOperation(operation);\n    },\n    [manager]\n  );\n\n  /**\n   * Register event handler\n   *\n   * Returns a handler ID that can be used to unregister the handler.\n   */\n  const registerEventHandler = useCallback(\n    (nodeId: string, eventType: string, handler: Function): string => {\n      const handlerId = `${nodeId}-${eventType}-${Date.now()}-${Math.random()}`;\n      eventHandlers.set(handlerId, handler);\n      return handlerId;\n    },\n    [eventHandlers]\n  );\n\n  /**\n   * Unregister event handler\n   */\n  const unregisterEventHandler = useCallback(\n    (handlerId: string): void => {\n      eventHandlers.delete(handlerId);\n    },\n    [eventHandlers]\n  );\n\n  const value: RemoteDOMContextValue = {\n    manager,\n    sendOperation,\n    registerEventHandler,\n    unregisterEventHandler,\n    eventHandlers,\n  };\n\n  return <RemoteDOMContext.Provider value={value}>{children}</RemoteDOMContext.Provider>;\n};\n\n/**\n * Use Remote DOM Manager\n *\n * Hook to access the Remote DOM Manager from context.\n *\n * @throws Error if used outside RemoteDOMProvider\n *\n * @example\n * ```tsx\n * const CustomComponent = () => {\n *   const manager = useRemoteDOMManager();\n *\n *   useEffect(() => {\n *     manager.sendOperation({\n *       type: 'createElement',\n *       tagName: 'div',\n *       nodeId: 'custom-div'\n *     });\n *   }, [manager]);\n *\n *   return null;\n * };\n * ```\n */\nexport function useRemoteDOMManager(): RemoteDOMWorkerManager {\n  const context = useContext(RemoteDOMContext);\n  if (!context) {\n    throw new Error('useRemoteDOMManager must be used within RemoteDOMProvider');\n  }\n  return context.manager;\n}\n\n/**\n * Use Remote DOM Context\n *\n * Hook to access the full Remote DOM context value.\n *\n * @throws Error if used outside RemoteDOMProvider\n *\n * @example\n * ```tsx\n * const CustomComponent = () => {\n *   const { sendOperation, registerEventHandler } = useRemoteDOMContext();\n *\n *   const handleClick = useCallback(() => {\n *     console.log('Element clicked');\n *   }, []);\n *\n *   useEffect(() => {\n *     const nodeId = 'my-element';\n *     sendOperation({\n *       type: 'createElement',\n *       tagName: 'button',\n *       nodeId\n *     });\n *\n *     const handlerId = registerEventHandler(nodeId, 'click', handleClick);\n *\n *     return () => {\n *       unregisterEventHandler(handlerId);\n *     };\n *   }, [sendOperation, registerEventHandler, handleClick]);\n *\n *   return null;\n * };\n * ```\n */\nexport function useRemoteDOMContext(): RemoteDOMContextValue {\n  const context = useContext(RemoteDOMContext);\n  if (!context) {\n    throw new Error('useRemoteDOMContext must be used within RemoteDOMProvider');\n  }\n  return context;\n}\n\n/**\n * Node ID Counter\n *\n * Global counter for generating unique node IDs.\n */\nlet nodeIdCounter = 0;\n\n/**\n * Use Remote DOM Node ID\n *\n * Hook to generate a unique node ID for a component.\n * The ID remains stable across re-renders.\n *\n * @returns Unique node ID\n *\n * @example\n * ```tsx\n * const Button = ({ children, onClick }) => {\n *   const nodeId = useRemoteDOMNodeId();\n *   const { sendOperation, registerEventHandler } = useRemoteDOMContext();\n *\n *   useEffect(() => {\n *     // Create element\n *     sendOperation({\n *       type: 'createElement',\n *       tagName: 'button',\n *       nodeId\n *     });\n *\n *     // Register event handler\n *     if (onClick) {\n *       const handlerId = registerEventHandler(nodeId, 'click', onClick);\n *       return () => unregisterEventHandler(handlerId);\n *     }\n *   }, [nodeId, sendOperation, onClick]);\n *\n *   return null;\n * };\n * ```\n */\nexport function useRemoteDOMNodeId(): string {\n  const [nodeId] = useState(() => `node-${++nodeIdCounter}`);\n  return nodeId;\n}\n\n/**\n * Reset Node ID Counter\n *\n * Utility function to reset the node ID counter.\n * Useful for testing to ensure consistent IDs.\n *\n * WARNING: Only use this in tests, never in production code.\n *\n * @example\n * ```typescript\n * // In test setup\n * beforeEach(() => {\n *   resetNodeIdCounter();\n * });\n * ```\n */\nexport function resetNodeIdCounter(): void {\n  nodeIdCounter = 0;\n}\n"],
  "mappings": ";AAeA,OAAO,SAAS,eAAe,YAAY,UAAU,mBAAmB;AAyCxE,IAAM,mBAAmB,cAA4C,IAAI;AAkClE,IAAM,oBAAsD,CAAC,EAAE,SAAS,SAAS,MAAM;AAE5F,QAAM,CAAC,aAAa,IAAI,SAAS,MAAM,oBAAI,IAAsB,CAAC;AAKlE,QAAM,gBAAgB;AAAA,IACpB,OAAO,cAAkC;AACvC,aAAO,QAAQ,cAAc,SAAS;AAAA,IACxC;AAAA,IACA,CAAC,OAAO;AAAA,EACV;AAOA,QAAM,uBAAuB;AAAA,IAC3B,CAAC,QAAgB,WAAmB,YAA8B;AAChE,YAAM,YAAY,GAAG,MAAM,IAAI,SAAS,IAAI,KAAK,IAAI,CAAC,IAAI,KAAK,OAAO,CAAC;AACvE,oBAAc,IAAI,WAAW,OAAO;AACpC,aAAO;AAAA,IACT;AAAA,IACA,CAAC,aAAa;AAAA,EAChB;AAKA,QAAM,yBAAyB;AAAA,IAC7B,CAAC,cAA4B;AAC3B,oBAAc,OAAO,SAAS;AAAA,IAChC;AAAA,IACA,CAAC,aAAa;AAAA,EAChB;AAEA,QAAM,QAA+B;AAAA,IACnC;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF;AAEA,SAAO,oCAAC,iBAAiB,UAAjB,EAA0B,SAAe,QAAS;AAC5D;AA0BO,SAAS,sBAA8C;AAC5D,QAAM,UAAU,WAAW,gBAAgB;AAC3C,MAAI,CAAC,SAAS;AACZ,UAAM,IAAI,MAAM,2DAA2D;AAAA,EAC7E;AACA,SAAO,QAAQ;AACjB;AAqCO,SAAS,sBAA6C;AAC3D,QAAM,UAAU,WAAW,gBAAgB;AAC3C,MAAI,CAAC,SAAS;AACZ,UAAM,IAAI,MAAM,2DAA2D;AAAA,EAC7E;AACA,SAAO;AACT;AAOA,IAAI,gBAAgB;AAmCb,SAAS,qBAA6B;AAC3C,QAAM,CAAC,MAAM,IAAI,SAAS,MAAM,QAAQ,EAAE,aAAa,EAAE;AACzD,SAAO;AACT;AAkBO,SAAS,qBAA2B;AACzC,kBAAgB;AAClB;",
  "names": []
}
