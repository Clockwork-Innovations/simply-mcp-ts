# Test Suite Documentation - Claude Code Instructions

This file provides context and instructions for AI assistants working on the test suite.

## Project Structure

```
tests/
├── .claude.md              # This file - AI assistant instructions
├── assets/                 # Centralized large test files (excluded from git)
│   ├── README.md
│   ├── test-large.bin      # 15MB test file (generated)
│   └── test-very-large.bin # 55MB test file (generated)
├── fixtures/               # Test fixtures and helper files
│   └── test-decorator-class.ts
├── phase2/                 # Phase 2 feature tests
│   ├── assets/            # Phase 2 specific test assets
│   │   └── (images, PDFs, audio files, etc.)
│   ├── fixtures/          # Phase 2 test fixtures
│   └── test-*.sh          # Phase 2 test scripts
├── run-all-tests.sh       # Master test runner
├── test-*.sh              # Individual test suites
└── test-*.ts              # TypeScript test clients
```

## Test Asset Management

### Large Files (>1MB)
- **Storage:** `tests/assets/` directory
- **Git:** Excluded via `.gitignore`
- **Generation:** Run `tests/phase2/generate-test-assets.sh`
- **Purpose:** Centralized location for reusable large test files

### Small Files (<1MB)
- **Storage:** Keep in appropriate subdirectories (`phase2/assets/`, `fixtures/`)
- **Git:** Committed to repository
- **Purpose:** Test-specific assets (images, PDFs, etc.)

## Path References

When updating test scripts, use these patterns:

### For large binary files:
```bash
# Old (deprecated)
LARGE_FILE="tests/phase2/assets/test-large.bin"

# New (preferred)
LARGE_FILE="tests/assets/test-large.bin"
```

### For project root:
```bash
PROJECT_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
ASSETS_DIR="$PROJECT_ROOT/tests/assets"
```

## Test Suites

### Core Transport Tests
- `test-stdio.sh` - Stdio transport (13 tests)
- `test-stateless-http.sh` - Stateless HTTP (10 tests)
- `test-stateful-http.sh` - Stateful HTTP (18 tests)
- `test-http-modes.sh` - HTTP modes (stateful/stateless)

**Note:** All servers use the Interface API exclusively. See [QUICK_START.md](docs/guides/QUICK_START.md) for current usage.

### Phase 2 Tests
- Binary content handling
- Auto-installation features
- Bundling functionality
- Inline dependencies

## Common Tasks

### Adding a New Test Suite
1. Create `test-<name>.sh` in `tests/`
2. Add to `run-all-tests.sh`
3. Follow existing test structure (initialization, test cases, cleanup)
4. Use consistent output formatting

### Updating Path References
1. Search for references to old paths: `grep -r "phase2/assets/test-large.bin" tests/`
2. Update to new centralized path: `tests/assets/test-large.bin`
3. Verify tests still pass: `bash tests/run-all-tests.sh`

### Regenerating Test Assets
```bash
cd tests/phase2
bash generate-test-assets.sh
```

## Guidelines for AI Assistants

### When Updating Tests:
1. ✅ Use centralized `tests/assets/` for large files (>1MB)
2. ✅ Keep small assets in test-specific directories
3. ✅ Update path references consistently across all scripts
4. ✅ Run tests after changes to verify nothing breaks
5. ✅ Update documentation when adding new test files

### Path Update Strategy:
- Find all references: `grep -r "test-large.bin" tests/`
- Update systematically: Start with most-used scripts first
- Verify after each change: Run affected test suite
- Document changes: Update this file if patterns change

### Test Verification:
```bash
# Run individual suite
bash tests/test-stdio.sh

# Run all suites
bash tests/run-all-tests.sh

# Check for broken paths
grep -r "phase2/assets/test-.*large.bin" tests/ --include="*.sh"
```

## Current Status

### Last Updated
- **Date:** 2025-10-27
- **Version:** v4.0.0+
- **Status:** Deprecated API tests removed, Interface API only

### Completed Cleanup
- [x] Deprecated API tests removed from codebase
- [x] Test runner scripts updated to remove deprecated test references
- [x] Documentation updated to reflect current test structure
- [x] Jest configuration updated to exclude markdown files from test execution

### Active Test Suites
Only Interface API tests are actively maintained.

## Contact

For questions about the test suite architecture, refer to:
- `tests/README.md` - General test documentation
- `tests/phase2/assets/README.md` - Phase 2 asset documentation
- `tests/assets/README.md` - Centralized assets documentation
